towerdefenceApp.controller("GameContextCtrl",function($scope,$http,$routeParams,$timeout,gameContextFactory){function setTowerToPosition(columID,rowID){$scope.message="setTower to "+columID+", "+rowID;var setTowerUrl="/settower/"+columID+"/"+rowID;updateFunction(setTowerUrl)}function showFieldInformation(fieldContent){$scope.message=fieldContent;var fieldKey=Object.keys(fieldContent);var fieldKeyString=fieldKey.toString();$scope.fieldType=checkFieldContent(fieldContent);if($scope.fieldType=="mob"){$scope.message=
fieldContent.mobList[0];$scope.fieldProperties=fieldContent.mobList[0]}else{$scope.message=fieldContent[$scope.fieldType];$scope.fieldProperties=fieldContent[$scope.fieldType]}}function checkFieldContent(fieldContent){var fieldKey=Object.keys(fieldContent);var fieldKeyString=fieldKey.toString();switch(fieldKeyString){case "tower":return"tower";case "mobList,sizeMobList":return"mob";checkIfGameOver();default:return""}}function updateFunction(url){if(!stop){var response=$http.post(url,$scope.gameContext);
response.success(function(dataFromServer,status,headers,config){$scope.gameContext=dataFromServer;checkIfGameOver($scope.gameContext)});response.error(function(data,status,headers,config){alert("Submitting GameContext failed!")})}}function checkIfGameOver(gameContext){if(gameContext.player.life<=0){alert("Game Over !");stop=true}}$scope.message="Debug Messages";$scope.uiState="setTower";var updateTime=500;var updateTimer;var pause=false;var stop=false;$scope.fieldType;$scope.fieldProperties;$scope.gameContext=
{};$scope.clickOnField=function(columID,rowID,fieldContent){if($scope.uiState=="setTower")setTowerToPosition(columID,rowID);else showFieldInformation(fieldContent)};$scope.getFieldContent=function(fieldContent){return checkFieldContent(fieldContent)};$scope.sendMob=function(){$scope.message="Send Mob from Start";var sendMobURL="/sendMob";updateFunction(sendMobURL)};$scope.pause=function(){if(pause)$scope.intervalFunction();else $timeout.cancel(updateTimer);pause=!pause};$scope.filterProperties=function(key){switch(key){case "controllable":return false;
case "lastTime":return false;case "tmpSpeed":return false;case "tmpCoord":return false;case "position":return false;case "coord":return false;default:return true}};$scope.intervalFunction=function(){updateTimer=$timeout(function(){updateFunction("/update");$scope.intervalFunction()},updateTime)};$scope.intervalFunction();$scope.$on("$destroy",function(){$timeout.cancel(updateTimer);alert("Stop Controller")})});