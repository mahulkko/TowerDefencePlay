towerdefenceApp.controller("GameContextCtrl",function($rootScope,$scope,$http,$routeParams,$timeout,$location,gameContextFactory){function setTowerToPosition(columID,rowID){$scope.message="setTower to "+columID+", "+rowID;actionURL="/settower/"+columID+"/"+rowID;$scope.message=actionURL;actionHappen=true}function showFieldInformation(fieldContent){$scope.message="Show Field Infomations: "+fieldContent;$scope.fieldType=compareFieldKeyString(fieldContent);if($scope.fieldType=="mob"){$scope.message=
fieldContent.mobList[0];$scope.fieldProperties=fieldContent.mobList[0]}else{$scope.message=fieldContent[$scope.fieldType];$scope.fieldProperties=fieldContent[$scope.fieldType]}}function updateInfoField(){var fieldContent=getFieldContentByPosition($scope.position.x,$scope.position.y);showFieldInformation(fieldContent)}function checkFieldContent(x,y,fieldContent){var fieldTypeString=compareFieldKeyString(fieldContent);var found=false;angular.forEach($scope.gameContext.ShortestWay,function(item){if(!found)if(x==
item.x&&y==item.y)if(fieldTypeString!="mob"){fieldTypeString="way";found=true}});return fieldTypeString}function compareFieldKeyString(fieldContent){var fieldKey=Object.keys(fieldContent);var fieldKeyString=fieldKey.toString();switch(fieldKeyString){case "tower":return"tower";case "mobList,sizeMobList":return"mob";default:return""}}function getFieldContentByPosition(x,y){var row=$scope.gameContext.playingField.fieldArray["row"+y];var fieldContent=row[x];return fieldContent}function updateFunction(url){if(actionHappen){url=
actionURL;actionHappen=false}var response=$http.post(url,$scope.gameContext);response.success(function(dataFromServer,status,headers,config){$scope.gameContext=dataFromServer;checkIfGameOver($scope.gameContext);updateInfoField()});response.error(function(data,status,headers,config){$scope.message="Cant connect to Server !!"})}function checkIfGameOver(gameContext){if(gameContext.player.life<=0){$timeout.cancel(updateTimer);alert("Game Over !")}}$scope.message="DebugMessage";$scope.uiState="setTower";
var actionHappen=false;var actionUrl="";var updateTime=500;var updateTimer;var pause=false;$scope.fieldType;$scope.fieldProperties;$scope.position={};$scope.gameContext={};$scope.clickOnField=function(columID,rowID,fieldContent){$scope.position.x=columID;$scope.position.y=rowID;if($scope.uiState=="setTower")setTowerToPosition(columID,rowID);else showFieldInformation(fieldContent)};$scope.getFieldContent=function(columID,rowID,fieldContent){return checkFieldContent(columID,rowID,fieldContent)};$scope.sendMob=
function(){$scope.message="Send Mob from Start";actionURL="/sendMob";actionHappen=true};$scope.pause=function(){$scope.message="Pause Game";if(pause)$scope.intervalFunction();else $timeout.cancel(updateTimer);pause=!pause};$scope.upgradeTower=function(){$scope.message="upgrade Tower on Position "+$scope.position.x+", "+$scope.position.y;actionURL="/upgradetower/"+$scope.position.x+"/"+$scope.position.y;$scope.message=actionURL;actionHappen=true;updateInfoField()};$scope.filterProperties=function(key){switch(key){case "controllable":return false;
case "lastTime":return false;case "tmpSpeed":return false;case "tmpCoord":return false;case "position":return false;case "coord":return false;default:return true}};$scope.startNewGame=function(){var newGameURL="/startnewgame/"+$rootScope.playername+"/"+$rootScope.playerlife+"/"+$rootScope.playermoney+"/"+$rootScope.playeremail+"/"+$rootScope.playingfieldsize+"/"+$rootScope.playingfieldsize;$scope.message=newGameURL;var response=$http.post(newGameURL,$scope.gameContext);response.success(function(dataFromServer,
status,headers,config){$scope.gameContext=dataFromServer;alert($rootScope.playername+": Click OK to start the game");$scope.intervalFunction()});response.error(function(data,status,headers,config){alert("Can't create new game. Sorry !")})};$scope.intervalFunction=function(){updateTimer=$timeout(function(){updateFunction("/update");$scope.intervalFunction()},updateTime)};$scope.startNewGame();$scope.$on("$destroy",function(){$timeout.cancel(updateTimer)})});
towerdefenceApp.controller("LoginCtrl",function($rootScope,$scope,$http,$routeParams,$location){function checkLogin(){$rootScope.login=true}function checkSocialLogin(){$rootScope.login=true;window.open("/protected","_self")}function copyLogginDataToGlobal(){$rootScope.playername=$scope.playername;$rootScope.playerlife=$scope.playerlife;$rootScope.playermoney=$scope.playermoney;$rootScope.playeremail=$scope.playeremail;$rootScope.playingfieldsize=$scope.playingfieldsize}$scope.clickOnLoggin=function(){copyLogginDataToGlobal();
checkLogin();$location.path("/game")};$scope.clickOnGoogleLoggin=function(){copyLogginDataToGlobal();checkSocialLogin()};$scope.clickOnFacebookLoggin=function(){copyLogginDataToGlobal();checkSocialLogin()}});towerdefenceApp.controller("RulesCtrl",function($rootScope,$scope,$http,$routeParams,$location){});